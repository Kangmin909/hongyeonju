{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/kangmin/Desktop/project/hongyeonju/src/pages/api/getWorks.js"],"sourcesContent":["import { Client } from \"@notionhq/client\";\n\nconst notion = new Client({ auth: process.env.NOTION_TOKEN });\n\n// 로컬/서버 공통 메모리 캐시\nlet localCache = null;\nlet lastFetchTime = 0;\nconst CACHE_TTL = 1000 * 60 * 60; // 1시간 (메모리 캐시 유지)\n\nexport default async function handler(req, res) {\n  const { force } = req.query;\n\n  // 1. 메모리 캐시 확인 (force가 아닐 때)\n  if (force !== \"true\" && localCache && (Date.now() - lastFetchTime < CACHE_TTL)) {\n    // CDN에는 \"1초만 저장해\"라고 해서 요청이 서버(여기)로 오게 유도하고,\n    // 서버에서는 메모리 캐시를 즉시 반환하여 속도와 최신성을 모두 잡음\n    res.setHeader(\"Cache-Control\", \"public, s-maxage=1\"); \n    return res.status(200).json(localCache);\n  }\n\n  try {\n    const databaseId = process.env.NOTION_WORKS_DB_ID;\n\n    const response = await notion.databases.query({\n      database_id: databaseId,\n      sorts: [\n        {\n          property: \"id\",\n          direction: \"ascending\",\n        },\n      ],\n    });\n\n    const data = response.results.map((page) => {\n      return {\n        id: page.properties.id.title[0]?.plain_text || \"\",\n        year: page.properties.year.select?.name || \"\",\n        title: page.properties.title.rich_text[0]?.plain_text || \"\",\n        meta: page.properties.meta.rich_text[0]?.plain_text || \"\",\n        link: page.properties.link.url || \"\",\n      };\n    });\n\n    // 2. 캐시 업데이트 (메모리 최신화)\n    localCache = data;\n    lastFetchTime = Date.now();\n\n    // 3. 응답 설정\n    // s-maxage=1 : CDN 캐시는 1초만에 만료 -> 사용자는 거의 매번 최신 상태 확인 가능\n    // stale-while-revalidate 제거 : 옛날 데이터를 보여주지 않음\n    res.setHeader(\n      \"Cache-Control\",\n      \"public, s-maxage=1\"\n    );\n\n    res.status(200).json(data);\n  } catch (err) {\n    console.error(err);\n    res.status(500).json({ error: \"Failed to load works\" });\n  }\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,SAAS,IAAI,sMAAM,CAAC;IAAE,MAAM,QAAQ,GAAG,CAAC,YAAY;AAAC;AAE3D,kBAAkB;AAClB,IAAI,aAAa;AACjB,IAAI,gBAAgB;AACpB,MAAM,YAAY,OAAO,KAAK,IAAI,kBAAkB;AAErC,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,KAAK;IAE3B,6BAA6B;IAC7B,IAAI,UAAU,UAAU,cAAe,KAAK,GAAG,KAAK,gBAAgB,WAAY;QAC9E,4CAA4C;QAC5C,uCAAuC;QACvC,IAAI,SAAS,CAAC,iBAAiB;QAC/B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IAC9B;IAEA,IAAI;QACF,MAAM,aAAa,QAAQ,GAAG,CAAC,kBAAkB;QAEjD,MAAM,WAAW,MAAM,OAAO,SAAS,CAAC,KAAK,CAAC;YAC5C,aAAa;YACb,OAAO;gBACL;oBACE,UAAU;oBACV,WAAW;gBACb;aACD;QACH;QAEA,MAAM,OAAO,SAAS,OAAO,CAAC,GAAG,CAAC,CAAC;YACjC,OAAO;gBACL,IAAI,KAAK,UAAU,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,EAAE,cAAc;gBAC/C,MAAM,KAAK,UAAU,CAAC,IAAI,CAAC,MAAM,EAAE,QAAQ;gBAC3C,OAAO,KAAK,UAAU,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,EAAE,cAAc;gBACzD,MAAM,KAAK,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,EAAE,cAAc;gBACvD,MAAM,KAAK,UAAU,CAAC,IAAI,CAAC,GAAG,IAAI;YACpC;QACF;QAEA,uBAAuB;QACvB,aAAa;QACb,gBAAgB,KAAK,GAAG;QAExB,WAAW;QACX,yDAAyD;QACzD,8CAA8C;QAC9C,IAAI,SAAS,CACX,iBACA;QAGF,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IACvB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAuB;IACvD;AACF"}}]
}