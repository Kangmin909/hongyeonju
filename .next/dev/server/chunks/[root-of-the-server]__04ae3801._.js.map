{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/kangmin/Desktop/project/hongyeonju/src/pages/api/getExhibition.js"],"sourcesContent":["import { Client } from \"@notionhq/client\";\n\nconst notion = new Client({ auth: process.env.NOTION_TOKEN });\n\nexport default async function handler(req, res) {\n  try {\n    const databaseId = process.env.NOTION_EXHIBITION_DB_ID;\n\n    const response = await notion.databases.query({\n      database_id: databaseId,\n    });\n\n    const data = await Promise.all(\n      response.results.map(async (page) => {\n        const props = page.properties;\n        const pageId = page.id;\n\n        const getPlainText = (prop) => {\n          if (!prop) return \"\";\n          if (prop.title) return prop.title[0]?.plain_text || \"\";\n          if (prop.rich_text) return prop.rich_text[0]?.plain_text || \"\";\n          if (prop.select) return prop.select.name || \"\";\n          return \"\";\n        };\n\n        const titleProp = Object.values(props).find((p) => p.type === \"title\");\n        const id = titleProp ? titleProp.title[0]?.plain_text || \"\" : \"\";\n\n        let images = [];\n        const relationProp = props.ExhibitionDetail || props.Detail || Object.values(props).find(p => p.type === 'relation');\n\n        if (relationProp && relationProp.relation && relationProp.relation.length > 0) {\n          const relatedIds = relationProp.relation.map((r) => r.id);\n          const relatedPages = await Promise.all(\n            relatedIds.map((id) => notion.pages.retrieve({ page_id: id }).catch(() => null))\n          );\n\n          images = relatedPages\n            .filter((p) => p)\n            .map((p) => {\n              const pProps = p.properties;\n              \n              const linkProp = pProps.link || pProps.Link || Object.values(pProps).find(prop => prop.type === 'url');\n              let link = linkProp?.url || \"\";\n\n              if (!link) {\n                const fileProp = Object.values(pProps).find(prop => prop.type === 'files');\n                const fileObj = fileProp?.files?.[0];\n                link = fileObj?.file?.url || fileObj?.external?.url || \"\";\n              }\n\n              const idProp = pProps.id || pProps.ID || Object.values(pProps).find(prop => prop.type === 'title');\n              let idVal = idProp?.title?.[0]?.plain_text || \"\";\n\n              let titleProp = pProps.title || pProps.Title;\n              let titleVal = titleProp?.rich_text?.[0]?.plain_text || \"\";\n              \n              if (!titleVal) {\n                 const fallbackProp = Object.values(pProps).find(prop => prop.type === 'rich_text' && prop !== titleProp);\n                 titleVal = fallbackProp?.rich_text?.[0]?.plain_text || \"\";\n              }\n\n              let metaProp = pProps.meta || pProps.Meta;\n              let metaVal = metaProp?.rich_text?.[0]?.plain_text || \"\";\n              \n              if (!metaVal) {\n                 const fallbackMeta = Object.values(pProps).find(prop => prop.type === 'rich_text' && prop !== titleProp && prop !== metaProp);\n                 metaVal = fallbackMeta?.rich_text?.[0]?.plain_text || \"\";\n              }\n\n              return { id: idVal || p.id, title: titleVal, meta: metaVal, link };\n            })\n            .filter(item => item.link)\n            .sort((a, b) => a.id.localeCompare(b.id, undefined, { numeric: true }));\n        }\n\n        return {\n          id: id,\n          year: getPlainText(props.year),\n          exhibitionTitle: getPlainText(props.exhibitionTitle),\n          date: getPlainText(props.date),\n          location: getPlainText(props.location),\n          description: getPlainText(props.description),\n          link: props.link?.url || \"\",\n          images,\n        };\n      })\n    );\n\n    res.setHeader(\n      \"Cache-Control\",\n      \"public, s-maxage=60, stale-while-revalidate=604800\"\n    );\n\n    res.status(200).json(data);\n  } catch (err) {\n    console.error(\"Exhibition API Error:\", err);\n    res.status(500).json({ error: \"Failed to load exhibitions\" });\n  }\n}"],"names":[],"mappings":"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"}}]
}