{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/kangmin/Desktop/project/hongyeonju/src/pages/api/getExhibition.js"],"sourcesContent":["import { Client } from \"@notionhq/client\";\n\nconst notion = new Client({ auth: process.env.NOTION_TOKEN });\n\nlet localCache = null;\nlet lastFetchTime = 0;\nconst CACHE_TTL = 1000 * 60 * 30;\n\nexport default async function handler(req, res) {\n  const { force } = req.query;\n\n  if (force !== \"true\" && localCache && (Date.now() - lastFetchTime < CACHE_TTL)) {\n    res.setHeader(\"Cache-Control\", \"s-maxage=1800, stale-while-revalidate=3600\");\n    return res.status(200).json(localCache);\n  }\n\n  try {\n    const databaseId = process.env.NOTION_EXHIBITION_DB_ID;\n\n    const response = await notion.databases.query({\n      database_id: databaseId,\n      sorts: [{ property: \"id\", direction: \"ascending\" }],\n    });\n\n    const data = await Promise.all(\n      response.results.map(async (page) => {\n        const props = page.properties;\n        const pageId = page.id;\n\n        const blocks = await notion.blocks.children.list({ block_id: pageId });\n        const images = blocks.results\n          .filter((block) => block.type === \"image\")\n          .map((block) => ({\n            id: block.id,\n            title: block.image.caption[0]?.plain_text || \"\",\n            meta: block.image.caption[1]?.plain_text || \"\",\n            link: block.image.type === \"external\" ? block.image.external.url : block.image.file.url,\n          }));\n\n        return {\n          id: props.id.title[0]?.plain_text || \"\",\n          year: props.year.select?.name || \"\",\n          exhibitionTitle: props.exhibitionTitle.rich_text[0]?.plain_text || \"\",\n          date: props.date.rich_text[0]?.plain_text || \"\",\n          location: props.location.rich_text[0]?.plain_text || \"\",\n          description: props.description.rich_text[0]?.plain_text || \"\",\n          link: props.link.url || \"\",\n          images,\n        };\n      })\n    );\n\n    localCache = data;\n    lastFetchTime = Date.now();\n\n    if (force === \"true\") {\n      res.setHeader(\"Cache-Control\", \"no-store, max-age=0\");\n    } else {\n      res.setHeader(\"Cache-Control\", \"s-maxage=1800, stale-while-revalidate=3600\");\n    }\n\n    res.status(200).json(data);\n  } catch (err) {\n    console.error(err);\n    res.status(500).json({ error: \"Failed to load exhibitions\" });\n  }\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,SAAS,IAAI,sMAAM,CAAC;IAAE,MAAM,QAAQ,GAAG,CAAC,YAAY;AAAC;AAE3D,IAAI,aAAa;AACjB,IAAI,gBAAgB;AACpB,MAAM,YAAY,OAAO,KAAK;AAEf,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,KAAK;IAE3B,IAAI,UAAU,UAAU,cAAe,KAAK,GAAG,KAAK,gBAAgB,WAAY;QAC9E,IAAI,SAAS,CAAC,iBAAiB;QAC/B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IAC9B;IAEA,IAAI;QACF,MAAM,aAAa,QAAQ,GAAG,CAAC,uBAAuB;QAEtD,MAAM,WAAW,MAAM,OAAO,SAAS,CAAC,KAAK,CAAC;YAC5C,aAAa;YACb,OAAO;gBAAC;oBAAE,UAAU;oBAAM,WAAW;gBAAY;aAAE;QACrD;QAEA,MAAM,OAAO,MAAM,QAAQ,GAAG,CAC5B,SAAS,OAAO,CAAC,GAAG,CAAC,OAAO;YAC1B,MAAM,QAAQ,KAAK,UAAU;YAC7B,MAAM,SAAS,KAAK,EAAE;YAEtB,MAAM,SAAS,MAAM,OAAO,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC;gBAAE,UAAU;YAAO;YACpE,MAAM,SAAS,OAAO,OAAO,CAC1B,MAAM,CAAC,CAAC,QAAU,MAAM,IAAI,KAAK,SACjC,GAAG,CAAC,CAAC,QAAU,CAAC;oBACf,IAAI,MAAM,EAAE;oBACZ,OAAO,MAAM,KAAK,CAAC,OAAO,CAAC,EAAE,EAAE,cAAc;oBAC7C,MAAM,MAAM,KAAK,CAAC,OAAO,CAAC,EAAE,EAAE,cAAc;oBAC5C,MAAM,MAAM,KAAK,CAAC,IAAI,KAAK,aAAa,MAAM,KAAK,CAAC,QAAQ,CAAC,GAAG,GAAG,MAAM,KAAK,CAAC,IAAI,CAAC,GAAG;gBACzF,CAAC;YAEH,OAAO;gBACL,IAAI,MAAM,EAAE,CAAC,KAAK,CAAC,EAAE,EAAE,cAAc;gBACrC,MAAM,MAAM,IAAI,CAAC,MAAM,EAAE,QAAQ;gBACjC,iBAAiB,MAAM,eAAe,CAAC,SAAS,CAAC,EAAE,EAAE,cAAc;gBACnE,MAAM,MAAM,IAAI,CAAC,SAAS,CAAC,EAAE,EAAE,cAAc;gBAC7C,UAAU,MAAM,QAAQ,CAAC,SAAS,CAAC,EAAE,EAAE,cAAc;gBACrD,aAAa,MAAM,WAAW,CAAC,SAAS,CAAC,EAAE,EAAE,cAAc;gBAC3D,MAAM,MAAM,IAAI,CAAC,GAAG,IAAI;gBACxB;YACF;QACF;QAGF,aAAa;QACb,gBAAgB,KAAK,GAAG;QAExB,IAAI,UAAU,QAAQ;YACpB,IAAI,SAAS,CAAC,iBAAiB;QACjC,OAAO;YACL,IAAI,SAAS,CAAC,iBAAiB;QACjC;QAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IACvB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA6B;IAC7D;AACF"}}]
}