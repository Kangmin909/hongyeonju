{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/kangmin/Desktop/project/hongyeonju/src/pages/api/getExhibition.js"],"sourcesContent":["import { Client } from \"@notionhq/client\";\n\nconst notion = new Client({ auth: process.env.NOTION_TOKEN });\n\nexport default async function handler(req, res) {\n  try {\n    const exhibitionDbId = process.env.NOTION_EXHIBITION_DB_ID;\n    const imageDbId = process.env.NOTION_EXHIBITION_DETAIL_DB_ID;\n\n    // 1️⃣ 전시 DB 조회\n    const exhibitionRes = await notion.databases.query({\n      database_id: exhibitionDbId,\n      sorts: [{ property: \"id\", direction: \"ascending\" }],\n    });\n\n    // 2️⃣ 이미지 DB 조회\n    const imageRes = await notion.databases.query({\n      database_id: imageDbId,\n      sorts: [{ property: \"id\", direction: \"ascending\" }],\n    });\n\n    // 3️⃣ 이미지 map (exhibitionId → images[])\n    const imageMap = {};\n\n    imageRes.results.forEach((page) => {\n      const exhibitionRel = page.properties.exhibition.relation[0]?.id;\n      if (!exhibitionRel) return;\n\n      if (!imageMap[exhibitionRel]) {\n        imageMap[exhibitionRel] = [];\n      }\n\n      imageMap[exhibitionRel].push({\n        id: page.properties.id.title[0]?.plain_text || \"\",\n        title: page.properties.title.rich_text[0]?.plain_text || \"\",\n        meta: page.properties.meta.rich_text[0]?.plain_text || \"\",\n        link: page.properties.link.url || \"\",\n      });\n    });\n\n    // 4️⃣ 최종 JSON 조립\n    const data = exhibitionRes.results.map((page) => {\n      const pageId = page.id;\n\n      return {\n        id: page.properties.id.title[0]?.plain_text || \"\",\n        year: page.properties.year?.select?.name || \"\",\n        exhibitionTitle: page.properties.exhibitionTitle?.rich_text?.[0]?.plain_text || \"\",\n        date: page.properties.date?.rich_text?.[0]?.plain_text || \"\",\n        location: page.properties.location?.rich_text?.[0]?.plain_text || \"\",\n        description: page.properties.description?.rich_text?.[0]?.plain_text || \"\",\n        link: page.properties.link?.url || \"\",\n        images: imageMap[pageId] || [],\n      };\n    });\n\n    res.status(200).json(data);\n  } catch (err) {\n    console.error(err);\n    res.status(500).json({ error: \"Failed to load exhibitions\" });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,SAAS,IAAI,sMAAM,CAAC;IAAE,MAAM,QAAQ,GAAG,CAAC,YAAY;AAAC;AAE5C,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI;QACF,MAAM,iBAAiB,QAAQ,GAAG,CAAC,uBAAuB;QAC1D,MAAM,YAAY,QAAQ,GAAG,CAAC,8BAA8B;QAE5D,eAAe;QACf,MAAM,gBAAgB,MAAM,OAAO,SAAS,CAAC,KAAK,CAAC;YACjD,aAAa;YACb,OAAO;gBAAC;oBAAE,UAAU;oBAAM,WAAW;gBAAY;aAAE;QACrD;QAEA,gBAAgB;QAChB,MAAM,WAAW,MAAM,OAAO,SAAS,CAAC,KAAK,CAAC;YAC5C,aAAa;YACb,OAAO;gBAAC;oBAAE,UAAU;oBAAM,WAAW;gBAAY;aAAE;QACrD;QAEA,wCAAwC;QACxC,MAAM,WAAW,CAAC;QAElB,SAAS,OAAO,CAAC,OAAO,CAAC,CAAC;YACxB,MAAM,gBAAgB,KAAK,UAAU,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,EAAE;YAC9D,IAAI,CAAC,eAAe;YAEpB,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE;gBAC5B,QAAQ,CAAC,cAAc,GAAG,EAAE;YAC9B;YAEA,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC;gBAC3B,IAAI,KAAK,UAAU,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,EAAE,cAAc;gBAC/C,OAAO,KAAK,UAAU,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,EAAE,cAAc;gBACzD,MAAM,KAAK,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,EAAE,cAAc;gBACvD,MAAM,KAAK,UAAU,CAAC,IAAI,CAAC,GAAG,IAAI;YACpC;QACF;QAEA,iBAAiB;QACjB,MAAM,OAAO,cAAc,OAAO,CAAC,GAAG,CAAC,CAAC;YACtC,MAAM,SAAS,KAAK,EAAE;YAEtB,OAAO;gBACL,IAAI,KAAK,UAAU,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,EAAE,cAAc;gBAC/C,MAAM,KAAK,UAAU,CAAC,IAAI,EAAE,QAAQ,QAAQ;gBAC5C,iBAAiB,KAAK,UAAU,CAAC,eAAe,EAAE,WAAW,CAAC,EAAE,EAAE,cAAc;gBAChF,MAAM,KAAK,UAAU,CAAC,IAAI,EAAE,WAAW,CAAC,EAAE,EAAE,cAAc;gBAC1D,UAAU,KAAK,UAAU,CAAC,QAAQ,EAAE,WAAW,CAAC,EAAE,EAAE,cAAc;gBAClE,aAAa,KAAK,UAAU,CAAC,WAAW,EAAE,WAAW,CAAC,EAAE,EAAE,cAAc;gBACxE,MAAM,KAAK,UAAU,CAAC,IAAI,EAAE,OAAO;gBACnC,QAAQ,QAAQ,CAAC,OAAO,IAAI,EAAE;YAChC;QACF;QAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IACvB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA6B;IAC7D;AACF"}}]
}